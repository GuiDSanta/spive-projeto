SQL

Comandos:

// Banco
CREATE DATABASE nome;
DROP DATABASE nome;
USE nome;

// Tabela
CREATE TABLE tabela (campo TIPO MODIFICADORES, campo TIPO MODIFICADORES...);
INSERT INTO tabela (campos) VALUES(valores),(valores)... ;
ALTER TABLE tabela MODIFY COLUMN coluna TIPO MODIFICADORES;
SELECT * ou campos FROM tabela;
SELECT * ou campo FROM tabela WHERE campo condicional valor;
DELETE FROM tabela WHERE campo condicional valor;
UPDATE tabela SET campo = valor WHERE id = valor;

Tipos de Dados:
INT
VARCHAR(max)
DECIMAL(max_car,casas_decimais)

Modificadores:
AUTO_INCREMENT
UNIQUE
PRIMARY KEY
FOREIGN KEY (campo_fk) REFERENCES tabela(campo)






CREATE DATABASE spive;

USE spive;

CREATE TABLE usuario(id int PRIMARY KEY AUTO_INCREMENT,
                    nome varchar(30) NOT NULL,
                    sobrenome varchar(70) NOT NULL,
                    email varchar(100) UNIQUE not null,
                    senha varchar(60) NOT NULL,
                    cep char(8) NOT NULL,
                    logradouro varchar(100) NOT NULL,
                    numero char(10) NOT NULL,
                    cpf char(11) UNIQUE NOT NULL,
                    nascimento date NOT NULL,
                    telefone varchar(11) NOT NULL);
                    



CREATE TABLE dispositivo(
id int PRIMARY KEY AUTO_INCREMENT,
    vidro_aberto bool NOT NULL,
temperatura int NOT NULL,
    umidade int NOT NULL,
    presenca int NOT NULL,
    oxigenio int NOT NULL,
    perigo_temp bool NOT NULL,
    perigo_oxi bool NOT NULL,
    ar_ligado bool NOT NULL,
    id_esp int NOT NULL,
    veiculo_id int NOT NULL,
    FOREIGN KEY (veiculo_id) REFERENCES veiculo(id_veiculo)
);


select * from usuario;

drop table usuario;



-- Código para salvar imagens no banco de dados -- 

<?php
include("verifySession.php");
include("conexaodb.php");

if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $numChassi = $_POST['numchassi'];
    $numMotor = $_POST['nummotor'];
    $idUsuario = $_SESSION['id_usuario'];

    $pasta = "uploads/";

    // Cria a pasta se não existir
    if (!is_dir($pasta)) {
        mkdir($pasta, 0777, true);
    }

    // --------------------------
    // 1. Salvar o comprovante
    // --------------------------
    $fotoComprovante = null;
    if (!empty($_FILES['fotoc']['name'])) {
        $ext = pathinfo($_FILES['fotoc']['name'], PATHINFO_EXTENSION);
        $novoNomeC = uniqid("comp_", true) . "." . strtolower($ext);
        $destinoC = $pasta . $novoNomeC;

        if (move_uploaded_file($_FILES['fotoc']['tmp_name'], $destinoC)) {
            $fotoComprovante = $destinoC;
        }
    }

    // --------------------------
    // 2. Inserir o veículo
    // --------------------------
    $sql = "INSERT INTO veiculos (id_usuario, num_chassi, num_motor, foto_comprovante)
            VALUES (?, ?, ?, ?)";
    $stmt = $conn->prepare($sql);
    $stmt->bind_param("isss", $idUsuario, $numChassi, $numMotor, $fotoComprovante);

    if ($stmt->execute()) {
        $idVeiculo = $stmt->insert_id; // pega o ID do veículo recém-cadastrado

        // --------------------------
        // 3. Salvar as fotos do veículo
        // --------------------------
        if (!empty($_FILES['foto']['name'][0])) {
            foreach ($_FILES['foto']['tmp_name'] as $i => $tmpName) {
                if ($_FILES['foto']['error'][$i] === 0) {
                    $ext = pathinfo($_FILES['foto']['name'][$i], PATHINFO_EXTENSION);
                    $novoNome = uniqid("foto_", true) . "." . strtolower($ext);
                    $destino = $pasta . $novoNome;

                    if (move_uploaded_file($tmpName, $destino)) {
                        $sqlFoto = "INSERT INTO veiculo_fotos (id_veiculo, caminho_foto) VALUES (?, ?)";
                        $stmtFoto = $conn->prepare($sqlFoto);
                        $stmtFoto->bind_param("is", $idVeiculo, $destino);
                        $stmtFoto->execute();
                        $stmtFoto->close();
                    }
                }
            }
        }

        echo "<script>alert('Veículo cadastrado com sucesso!'); window.location.href='telainicial.php';</script>";
    } else {
        echo "<script>alert('Erro ao cadastrar veículo.'); history.back();</script>";
    }

    $stmt->close();
    $conn->close();
}
?>


ALTER TABLE usuario ADD COLUMN foto_perfil VARCHAR(255) NULL;
